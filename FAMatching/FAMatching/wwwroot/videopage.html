<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>



    <video id="localVideo" autoplay playsinline></video>
    <video id="remoteVideo" autoplay playsinline></video>
    <button onclick="startvideoCall()">video Call</button>

    <a href="tel:+66996436494">Call </a>
</body>
</html>
<script>
    let localStream;
    let peerConnection = new RTCPeerConnection();
    let ws = new WebSocket("ws://localhost:7259/ws"); 

    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(stream => {
            document.getElementById("localVideo").srcObject = stream;
            localStream = stream;
        });

    ws.onmessage = async (event) => {
        let data = JSON.parse(event.data);
        if (data.offer) {
            await peerConnection.setRemoteDescription(new RTCSessionDescription(data.offer));
            let answer = await peerConnection.createAnswer();
            await peerConnection.setLocalDescription(answer);
            ws.send(JSON.stringify({ answer }));
        } else if (data.answer) {
            await peerConnection.setRemoteDescription(new RTCSessionDescription(data.answer));
        }
    };

    async function startCall() {
        console.log('startCall');
        let offer = await peerConnection.createOffer();
        await peerConnection.setLocalDescription(offer);
        ws.send(JSON.stringify({ offer }));
        console.log('offer', offer);
        console.log('JSON.stringify({ offer })', JSON.stringify({ offer }));
    }

    peerConnection.ontrack = (event) => {
        document.getElementById("remoteVideo").srcObject = event.streams[0];
    };
</script>
